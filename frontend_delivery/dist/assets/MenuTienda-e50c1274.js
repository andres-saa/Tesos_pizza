import{_ as se,e as W,j as m,g as Y,w as H,o as P,c as E,b as e,F as G,i as Z,n as X,t as I,k as ee,l as de,U as z,r as u,B as ne,q as b,a as s,d,h as q,m as ce,y as ue,C as pe,p as te,D as oe,E as ae}from"./index-0c0fb4fd.js";import{c as M}from"./categoriesService-3e5be12b.js";import{u as J,p as F}from"./ProductService-1d73d22c.js";import{a as O}from"./aditionalService-2e6c2d39.js";import{f as le}from"./formatoPesos-2a38d2e7.js";import"./reportes-1fa1c19c.js";const me={style:{position:"sticky",top:"4rem","z-index":"999","background-color":"white"},class:"col-12 shadow-3 d-flex p lg:justify-content-center align-items-center mb-5 p-0 md:p-0"},_e={class:"col-12 d-flex p lg:justify-content-center align-items-center p-0 md:p-1",style:{"overflow-x":"auto","background-color":"rgba(255, 255, 255, 0.913)"}},ve=["onClick"],fe={class:"text-lg",style:{"min-width":"max-content"}},ge={__name:"BarraCategorias",setup(v){const f=W(),t=m([]),r=(h,n)=>{n>=1e3?ee.push("/tienda-menu/productos/adicionales"):ee.push({name:"sesion",params:{menu_name:h,category_id:n}})};Y(async()=>{t.value=await M.getCategories()}),H(()=>f.restaurant_id,async()=>{t.value=await M.getCategories()});const y=h=>de().params.category_id==h.category_id;return(h,n)=>{var l;return P(),E("div",me,[e("div",_e,[(P(!0),E(G,null,Z((l=t.value)==null?void 0:l.filter(g=>g.category_id!=1e3),g=>(P(),E("div",{key:g.id,class:"p-1"},[e("button",{onClick:B=>r(g.category_name,g.category_id),class:X([y(g)?"selected menu-button":"menu-button","p-2 text-lg titulo"]),style:{"font-weight":"400","text-transform":"uppercase","min-width":"max-content"}},[e("span",fe,I(g.category_name),1)],10,ve)]))),128))])])}}},ye=se(ge,[["__scopeId","data-v-f9cb0ab0"]]),he={async getSites(){try{return(await fetch(`${z}/sites`)).json()}catch(v){console.log(v)}},async getSiteById(v){try{return(await fetch(`${z}/site/${v}`)).json()}catch(f){console.log(f)}},async siteDirectory(v){try{return(await fetch(`${z}/site/${v}/all-details`)).json()}catch(f){console.log(f)}}},be={class:"image",style:{display:"flex","flex-direction":"column","justify-content":"end","align-items":"end"}},we=["src"],xe=["src"],Pe={style:{display:"flex","flex-direction":"column",gap:"1rem"}},Ee=e("span",null,"Nombre:",-1),Ve=e("span",null,"descripcion:",-1),Te=e("span",null,"Precio anterior:",-1),$e=e("span",null,"Precio actual:",-1),ke={class:"text-center text-2xl py-4",style:{"font-weight":"bold","text-transform":"capitalize",display:"flex","align-items":"center","justify-content":"center",gap:"1rem"}},Ce={style:{"text-transform":"uppercase"}},De={style:{"font-weight":"bold"}},Ue={class:"col-12 px-0 pb-0"},Se={__name:"dialogEditProduct",setup(v){const f=m([]),t=J(),r=m([]),y=m(null),h=m(null),n=async c=>{const a=c.target.files[0];if(!a)return;y.value=URL.createObjectURL(a);const p=new FormData;p.append("file",a);try{const U=(await F.uploadPhoto(p)).image_identifier;t.currentProductToEdit.img_identifier=U,URL.revokeObjectURL(y.value)}catch(C){console.error("Error al subir la imagen:",C)}},l=()=>{!r.value||r.value.length===0||Object.entries(r.value).forEach(([c,a])=>{a.forEach(p=>{const C=f.value.some(U=>U.items.some(i=>i.aditional_item_name.toLowerCase()===p.item_name.toLowerCase()&&i.aditional_item_price===p.item_price&&i.aditional_item_type_name===p.type_name));p.status=C})})},g=c=>r.value[c].every(a=>a.status),B=(c,a)=>{r.value[c].forEach(p=>{p.status=a,V(p.item_id,c,a)})},V=(c,a,p)=>{const C=r.value[a].findIndex(U=>U.item_id===c);C!==-1&&(r.value[a][C].status=p)};H(()=>t.currentProductToEdit.id,async()=>{f.value=await O.getAditional(t.currentProductToEdit.id),r.value=await O.getAllAditionsRegistered(),l()});const T=m([]),D=()=>{let c=[];for(const a in r.value)r.value.hasOwnProperty(a)&&r.value[a].forEach(p=>{p.status&&c.push(p.item_id)});T.value=c,j()},j=()=>{const c={product_id:t.currentProductToEdit.id,name:t.currentProductToEdit.product_name,price:t.currentProductToEdit.price,last_price:t.currentProductToEdit.last_price||0,description:t.currentProductToEdit.product_description,category_id:t.currentProductToEdit.category_id,status:!0,img_identifier:t.currentProductToEdit.img_identifier,parent_id:t.currentProductToEdit.product_id},a=T.value;F.updateProductInstance(c,a)};return(c,a)=>{const p=u("Button"),C=u("InputText"),U=u("Textarea"),i=u("InputNumber"),o=u("InputSwitch"),_=u("Column"),$=u("DataTable"),L=u("Dialog");return P(),ne(L,{closeOnEscape:"",visible:d(t).visibles.dialogEditProduct,"onUpdate:visible":a[6]||(a[6]=w=>d(t).visibles.dialogEditProduct=w),modal:"",style:{width:"40rem"}},{footer:b(()=>[e("div",Ue,[s(p,{class:"",onClick:D,severity:"success",label:"Guardar"})])]),default:b(()=>[s(p,{onClick:a[0]||(a[0]=w=>d(t).visibles.dialogEditProduct=!1),severity:"danger",style:{position:"absolute",right:"-1rem",top:"-1rem"},rounded:"",icon:"pi pi-times"}),e("div",be,[y.value?(P(),E("img",{key:0,src:y.value,alt:"Preview",style:{width:"100%","aspect-ratio":"1 / 1","background-color":"rgb(255, 255, 255)","object-fit":"contain","border-radius":"0.2rem"}},null,8,we)):(P(),E("img",{key:1,class:"",style:{width:"100%","aspect-ratio":"1 / 1","background-color":"rgb(255, 255, 255)","object-fit":"contain","border-radius":"0.2rem"},src:`${d(z)}/read-photo-product/${d(t).currentProductToEdit.img_identifier}/600`,alt:""},null,8,xe)),s(p,{style:{},class:"my-3",severity:"help",onClick:a[1]||(a[1]=w=>h.value.click())},{default:b(()=>[q("Cambiar foto")]),_:1}),e("input",{type:"file",ref_key:"fileInput",ref:h,onChange:n,style:{display:"none"}},null,544)]),e("div",Pe,[e("div",null,[Ee,s(C,{modelValue:d(t).currentProductToEdit.product_name,"onUpdate:modelValue":a[2]||(a[2]=w=>d(t).currentProductToEdit.product_name=w),style:{width:"100%"}},null,8,["modelValue"])]),e("div",null,[Ve,s(U,{modelValue:d(t).currentProductToEdit.product_description,"onUpdate:modelValue":a[3]||(a[3]=w=>d(t).currentProductToEdit.product_description=w),rows:"3",style:{width:"100%",resize:"none"}},null,8,["modelValue"])]),e("div",null,[Te,s(i,{modelValue:d(t).currentProductToEdit.last_price,"onUpdate:modelValue":a[4]||(a[4]=w=>d(t).currentProductToEdit.last_price=w),prefix:"$",maxFractionDigits:"0",rows:"3",style:{width:"100%",resize:"none"}},null,8,["modelValue"])]),e("div",null,[$e,s(i,{modelValue:d(t).currentProductToEdit.price,"onUpdate:modelValue":a[5]||(a[5]=w=>d(t).currentProductToEdit.price=w),prefix:"$",maxFractionDigits:"0",rows:"3",style:{width:"100%",resize:"none"}},null,8,["modelValue"])])]),(P(!0),E(G,null,Z(r.value,(w,A)=>(P(),E("div",{class:"m-auto col-12 p-0",style:{"max-width":"600px"},key:A},[e("p",ke,[e("span",null,I(A),1),s(o,{modelValue:g(A),"onUpdate:modelValue":k=>B(A,k)},null,8,["modelValue","onUpdate:modelValue"])]),s($,{stripedRows:"",value:w,class:"p-0"},{default:b(()=>[s(_,{style:{"text-transform":"capitalize"},class:"p-0",field:"aditional_item_name",header:"Nombre"},{body:b(k=>[e("span",Ce,I(k.data.item_name),1)]),_:1}),s(_,{class:"p-0",field:"aditional_item_price",header:"Precio"},{body:b(k=>[e("span",De,I(d(le)(k.data.item_price)),1)]),_:1}),s(_,{class:"py-0 pl-4 p-0",header:"Estado",headerStyle:"width:1rem"},{body:b(k=>[s(o,{modelValue:k.data.status,"onUpdate:modelValue":[R=>k.data.status=R,R=>V(k.data.item_id,A,R)]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["value"])]))),128))]),_:1},8,["visible"])}}},Ie={async getAllRestaurants(){try{const v=await ce.get(`${z}/restaurants`);return v.status===200?v.data:(console.error("Error al obtener los restaurantes:",v.status),[])}catch(v){return console.error("Error al obtener los restaurantes:",v),[]}}},je={class:"image",style:{display:"flex","flex-direction":"column",position:"relative","justify-content":"end","align-items":"end"}},Ae=["src"],Be={key:1,style:{position:"absolute",left:"0",top:"0",width:"100%",display:"flex","justify-content":"center","align-items":"center",height:"100%","background-color":"#ffffff80"}},Re={style:{display:"flex","flex-direction":"column",gap:"1rem"}},Le=e("span",null,"ID de Categoría:",-1),Ne=e("span",null,"Nombre:",-1),ze=e("span",null,"Descripción:",-1),Fe=e("span",null,"Anterior Precio:",-1),Oe=e("span",null,"Precio Actual:",-1),Ge={class:"text-center text-2xl py-4",style:{"font-weight":"bold","text-transform":"capitalize",display:"flex","align-items":"center","justify-content":"center",gap:"1rem"}},qe={style:{"text-transform":"uppercase"}},Me={style:{"font-weight":"bold"}},We={class:"col-12 px-0 pb-0"},He=5,Je={__name:"dialogAddProduct",setup(v){const f=W(),t=ue(),r=m(!1),y=m([]),h=J(),n=m([]),l=m({product_name:"",product_description:"",price:0,last_price:0,category_id:null,restaurant_id:5,img_identifier:null}),g=m([]),B=m([]),V=m(null),T=m(null);Y(async()=>{try{B.value=await Ie.getAllRestaurants(),g.value=await M.getCategoriesByRestaurantId(5),n.value=await O.getAllAditionsRegistered()}catch(i){console.error("Error loading data:",i)}}),H(He,async(i,o)=>{i!==o&&(g.value=await M.getCategoriesByRestaurantId(5),l.value.category_id=null)},{deep:!0});const D=async i=>{const o=i.target.files[0];if(!o)return;V.value=URL.createObjectURL(o);const _=new FormData;_.append("file",o);try{r.value=!0;const $=await F.uploadPhoto(_);l.value.img_identifier=$.image_identifier,URL.revokeObjectURL(V.value),r.value=!1}catch($){console.error("Error uploading image:",$),r.value=!1}},j=i=>n.value[i].every(o=>o.status),c=(i,o)=>{n.value[i].forEach(_=>{_.status=o,a(_.item_id,i,o)})},a=(i,o,_)=>{const $=n.value[o].findIndex(L=>L.item_id===i);$!==-1&&(n.value[o][$].status=_)},p=()=>{if(typeof n.value!="object"||n.value===null){console.error("adicionales.value no es un objeto",n.value);return}let i=[];for(const o in n.value)n.value.hasOwnProperty(o)&&n.value[o].forEach(_=>{_.status&&i.push(_.item_id)});y.value=i,C()},C=async()=>{const i={name:l.value.product_name,price:l.value.price||0,last_price:l.value.last_price||0,description:l.value.product_description,category_id:l.value.category_id,restaurant_id:5,status:!0,img_identifier:l.value.img_identifier||"",parent_id:null},o=y.value;await F.createProductInstance(i,o),U()},U=()=>{var i,o;l.value={product_name:"",product_description:"",price:0,last_price:0,category_id:null,restaurant_id:5,img_identifier:null},V.value=null,((i=n.value)==null?void 0:i.length)>0&&((o=n.value)==null||o.forEach(_=>{_.forEach($=>{$.status=!1})})),t.add({severity:"success",summary:"Producto agregado",detail:"Listo",life:3e3}),h.visibles.dialogAddProduct=!1,f.update+=1};return(i,o)=>{const _=u("Button"),$=u("ProgressSpinner"),L=u("Dropdown"),w=u("InputText"),A=u("Textarea"),k=u("InputNumber"),R=u("InputSwitch"),K=u("Column"),ie=u("DataTable"),re=u("Dialog");return P(),E(G,null,[s(d(pe)),s(re,{closeOnEscape:"",visible:d(h).visibles.dialogAddProduct,"onUpdate:visible":o[7]||(o[7]=x=>d(h).visibles.dialogAddProduct=x),modal:"",style:{width:"40rem"}},{footer:b(()=>[e("div",We,[s(_,{onClick:p,severity:"success",label:"Guardar"})])]),default:b(()=>[s(_,{onClick:o[0]||(o[0]=x=>d(h).visibles.dialogAddProduct=!1),severity:"danger",style:{position:"absolute",right:"-1rem",top:"-1rem"},rounded:"",icon:"pi pi-times"}),e("div",je,[V.value?(P(),E("img",{key:0,src:V.value,alt:"Preview",style:{width:"100%","aspect-ratio":"1 / 1","background-color":"rgb(255, 255, 255)","object-fit":"cover","border-radius":"0.2rem"}},null,8,Ae)):te("",!0),r.value?(P(),E("div",Be,[s($,{strokeWidth:"8",style:{color:"white"}})])):te("",!0),s(_,{class:"my-3",severity:"help",onClick:o[1]||(o[1]=x=>T.value.click())},{default:b(()=>[q("Agregar foto")]),_:1}),e("input",{type:"file",ref_key:"fileInput",ref:T,onChange:D,style:{display:"none"}},null,544)]),e("div",Re,[e("div",null,[Le,s(L,{modelValue:l.value.category_id,"onUpdate:modelValue":o[2]||(o[2]=x=>l.value.category_id=x),options:g.value,optionLabel:"name",optionValue:"id",placeholder:"Selecciona una categoría",style:{width:"100%"}},null,8,["modelValue","options"])]),e("div",null,[Ne,s(w,{modelValue:l.value.product_name,"onUpdate:modelValue":o[3]||(o[3]=x=>l.value.product_name=x),style:{width:"100%"}},null,8,["modelValue"])]),e("div",null,[ze,s(A,{modelValue:l.value.product_description,"onUpdate:modelValue":o[4]||(o[4]=x=>l.value.product_description=x),rows:"3",style:{width:"100%",resize:"none"}},null,8,["modelValue"])]),e("div",null,[Fe,s(k,{modelValue:l.value.last_price,"onUpdate:modelValue":o[5]||(o[5]=x=>l.value.last_price=x),prefix:"$",maxFractionDigits:"0",style:{width:"100%"}},null,8,["modelValue"])]),e("div",null,[Oe,s(k,{modelValue:l.value.price,"onUpdate:modelValue":o[6]||(o[6]=x=>l.value.price=x),prefix:"$",maxFractionDigits:"0",style:{width:"100%"}},null,8,["modelValue"])])]),(P(!0),E(G,null,Z(n.value,(x,N)=>(P(),E("div",{class:"m-auto col-12 p-0",style:{"max-width":"600px"},key:N},[e("p",Ge,[e("span",null,I(N),1),s(R,{modelValue:j(N),"onUpdate:modelValue":S=>c(N,S)},null,8,["modelValue","onUpdate:modelValue"])]),s(ie,{stripedRows:"",value:x,class:"p-0"},{default:b(()=>[s(K,{style:{"text-transform":"capitalize"},class:"p-0",field:"aditional_item_name",header:"Nombre"},{body:b(S=>[e("span",qe,I(S.data.item_name),1)]),_:1}),s(K,{class:"p-0",field:"aditional_item_price",header:"Precio"},{body:b(S=>[e("span",Me,I(d(le)(S.data.item_price)),1)]),_:1}),s(K,{class:"py-0 pl-4 p-0",header:"Estado",headerStyle:"width:1rem"},{body:b(S=>[s(R,{modelValue:S.data.status,"onUpdate:modelValue":[Q=>S.data.status=Q,Q=>a(S.data.item_id,N,Q)]},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["value"])]))),128))]),_:1},8,["visible"])],64)}}};const Ke={class:"py-3",style:{overflow:"hidden"}},Qe=["src"],Xe={class:"col-12 p-0"},Ye={__name:"dialogDeleteProduct",setup(v){const f=W(),t=m(!1),r=()=>{t.value=!0,y.value=!y.value},y=m(!1),h=m([]),n=J(),l=m([]);m(n.currentProductToDelete);const g=()=>{!l.value||l.value.length===0||Object.entries(l.value).forEach(([V,T])=>{T.forEach(D=>{const j=h.value.some(c=>c.items.some(a=>a.aditional_item_name.toLowerCase()===D.item_name.toLowerCase()&&a.aditional_item_price===D.item_price&&a.aditional_item_type_name===D.type_name));D.status=j})})},B=async V=>{await F.deleteProduct(V),n.visibles.dialogDeleteProduct=!1,f.update+=1};return H(()=>n.currentProductToEdit.id,async()=>{h.value=await O.getAditional(n.currentProductToEdit.id),l.value=await O.getAllAditionsRegistered(),g()}),m([]),(V,T)=>{const D=u("Button"),j=u("Dialog");return P(),ne(j,{close:t.value=!1,closeOnEscape:"",visible:d(n).visibles.dialogDeleteProduct,"onUpdate:visible":T[1]||(T[1]=c=>d(n).visibles.dialogDeleteProduct=c),modal:"",style:{width:"20rem"}},{footer:b(()=>[e("div",Xe,[s(D,{style:{width:"100%"},onClick:T[0]||(T[0]=c=>B(d(n).currentProductToDelete.product_id)),severity:"danger",label:"Eliminar producto"})])]),default:b(()=>[q(" Esta seguro de eliminar "),e("b",null,I(d(n).currentProductToDelete.product_name),1),q(" ? "),e("div",Ke,[oe(e("img",{onLoad:r,class:X([t.value&&y.value?"cargado1":t.value&&!y.value?"cargado2":"nada",""]),style:{width:"100%",height:"100%","background-color":"rgb(255, 255, 255)","object-fit":"contain","border-radius":"0.2rem"},src:`https://backend.salchimonster.com/read-product-image/300/${d(n).currentProductToDelete.product_name}`,alt:""},null,42,Qe),[[ae,t.value]]),oe(e("div",{onLoad:r,class:X([t.value?"cargado":"sin-cargar","p-0"]),style:{width:"100%","aspect-ratio":"1 / 1","background-color":"rgb(255, 255, 255)",height:"100%","object-fit":"contain","border-radius":"0.2rem"},alt:""},null,34),[[ae,!t.value]])])]),_:1},8,["close","visible"])}}},Ze=se(Ye,[["__scopeId","data-v-cb127641"]]),et={style:{"border-radius":"1rem",position:"relative"},class:"mx-auto mx-0 p-0 mt-0"},tt={class:"mx-3 my0 mx-auto px-4",style:{"min-width":"max-content","max-width":"1024px","justify-content":"end",display:"flex","align-items":"end"}},rt={__name:"MenuTienda",setup(v){const f=J();W();const t=m([]),r=()=>{f.visibles.dialogAddProduct=!0},y=async()=>{t.value=await he.getSites()};return Y(async()=>{y()}),(h,n)=>{const l=u("Button"),g=u("router-view");return P(),E("div",et,[s(ye,{class:"m-0"}),e("div",tt,[s(l,{onClick:r,class:"ml-3",style:{"min-width":"max-content"},severity:"help",label:"Nuevo producto"})]),s(g,{class:""}),s(Se,{class:"m-3"}),s(Ze),s(Je)])}}};export{rt as default};
