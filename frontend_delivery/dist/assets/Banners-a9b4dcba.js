import{_ as J,b as l,j as K,d as Q,f as x,U as p,r as B,o as v,c as f,a as c,e as r,w,F as A,k as X,q as U,g as Y,n as Z,s as C,i as ee,v as ae,x as ne}from"./index-8c84e25c.js";import{B as te}from"./Banner-3a3211f2.js";import{p as oe}from"./ProductService-0ac95a0d.js";import"./fetchService-57b57f4c.js";import"./reportes-b03db83c.js";const F=g=>(ae("data-v-e24c84a5"),g=g(),ne(),g),re={style:{padding:"3rem"}},se=F(()=>r("h2",null,[r("b",null,"Arrastra y Reordena las Imágenes")],-1)),ie={class:"image",style:{display:"flex","flex-direction":"column",position:"relative","justify-content":"end","align-items":"end"}},le=["src"],ce={key:1,style:{position:"absolute",left:"0",top:"0",width:"100%",display:"flex","justify-content":"center","align-items":"center",height:"100%","background-color":"#ffffff80"}},de={class:"col-12 px-0 pb-0"},ue={class:"draggable-container"},pe=["onDragstart","onDragenter","onDrop"],ve=["src","alt"],fe=F(()=>r("div",{class:"confirmation-content"},[r("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"2rem",color:"#ff9800"}}),r("span",{class:"message"},"¿Estás seguro de que deseas eliminar esta imagen?")],-1)),ge={class:"dialog-footer"},me={__name:"Banners",setup(g){const t=l([]),m=l(-1),_=l(-1),y=l(!1),u=l(null),h=l(!1),k=l(!1),d=l([]),b=l(null),$=l(null),E=K(()=>t.value.slice().sort((e,a)=>e.index-a.index));Q(async()=>{await P()});async function P(){try{const e=await x.get(`${p}/banners/`);t.value=e.data.map((a,n)=>({...a,id:a.id??Date.now()+Math.random(),index:a.index??n,src:a.img_identifier,title:a.title??"Sin título"}))}catch(e){console.error("Error al obtener banners:",e)}}async function j(e){return(await x.post(`${p}/banners/`,e)).data}async function R(e){return(await x.post(`${p}/banners/reorder`,e)).data}async function L(e){return(await x.delete(`${p}/banners/${e}`)).data}function M(e){m.value=e}function N(e){_.value=e}function O(){_.value=-1}async function V(e){if(e===m.value)return;const a=E.value[m.value],n=t.value.findIndex(s=>s.id===a.id);t.value.splice(n,1),t.value.splice(e,0,a),t.value.forEach((s,i)=>{s.index=i}),m.value=-1,_.value=-1;try{const s=t.value.map(i=>({id:i.id,index:i.index,img_identifier:i.src}));await R(s)}catch(s){console.error("Error al reordenar banners:",s)}}function T(e){u.value=e,y.value=!0}function S(){y.value=!1,u.value=null}async function q(){if(u.value){try{await L(u.value.id);const e=t.value.findIndex(a=>a.id===u.value.id);e!==-1&&(t.value.splice(e,1),t.value.forEach((a,n)=>{a.index=n}))}catch(e){console.error("Error al eliminar banner:",e)}S()}}function z(){h.value=!0}function G(){$.value.click()}function H(e){const a=e.target.files;!a||a.length===0||(d.value=Array.from(a),d.value.length>0&&(b.value=URL.createObjectURL(d.value[0])),e.target.value="")}async function W(){if(d.value.length===0){alert("Por favor selecciona al menos una imagen.");return}k.value=!0;try{for(const e of d.value){const a=new FormData;a.append("file",e);const n=await oe.uploadPhoto(a),{image_identifier:s}=n,i={index:t.value.length,img_identifier:s},o=await j(i);t.value.push({id:o.id??Date.now()+Math.random(),index:o.index??t.value.length-1,src:o.img_identifier,title:e.name})}d.value=[],b.value=null,h.value=!1}catch(e){console.error("Error al subir las imágenes o crear banners:",e),alert("Hubo un error al subir las imágenes.")}finally{k.value=!1}}return(e,a)=>{const n=B("Button"),s=B("ProgressSpinner"),i=B("Dialog");return v(),f(A,null,[c(te),r("div",re,[se,c(n,{style:{margin:"1rem 0","background-color":"var(--primary-color)",border:"none"},label:"Agregar Imágenes",icon:"pi pi-upload",onClick:z}),c(i,{header:"Agregar Imágenes",visible:h.value,"onUpdate:visible":a[0]||(a[0]=o=>h.value=o),modal:"",style:{width:"40rem"}},{footer:w(()=>[r("div",de,[c(n,{onClick:W,severity:"success",label:"Guardar"})])]),default:w(()=>[r("div",ie,[b.value?(v(),f("img",{key:0,src:b.value,alt:"Preview",style:{width:"100%","aspect-ratio":"19 / 9","background-color":"rgb(255, 255, 255)","object-fit":"cover","border-radius":"0.2rem"}},null,8,le)):U("",!0),k.value?(v(),f("div",ce,[c(s,{strokeWidth:"8",style:{color:"white"}})])):U("",!0),c(n,{class:"my-3",severity:"help",onClick:G},{default:w(()=>[Y("Agregar foto")]),_:1}),r("input",{type:"file",ref_key:"fileInput",ref:$,onChange:H,style:{display:"none"},multiple:"",accept:"image/*"},null,544)])]),_:1},8,["visible"]),r("div",ue,[(v(!0),f(A,null,X(E.value,(o,D)=>(v(),f("div",{key:o.id,class:Z(["draggable-item",{"drag-over":_.value===D}]),draggable:"true",onDragstart:I=>M(D),onDragenter:C(I=>N(D),["prevent"]),onDragover:a[1]||(a[1]=C(()=>{},["prevent"])),onDragleave:O,onDrop:I=>V(D)},[r("img",{src:`${ee(p)}/read-photo-product/${o.src}`,alt:o.title},null,8,ve),c(n,{style:{"border-radius":"50%",position:"absolute","background-color":"var(--primary-color)",border:"3px solid","aspect-ratio":"1 / 1",right:"-1.5rem",top:"-1.5rem"},icon:"pi pi-times",severity:"info",class:"delete-button",onClick:C(I=>T(o),["stop"])},null,8,["onClick"])],42,pe))),128)),c(i,{header:"Confirmar Eliminación",visible:y.value,"onUpdate:visible":a[2]||(a[2]=o=>y.value=o),modal:"",closable:!1,style:{width:"350px"}},{default:w(()=>[fe,r("div",ge,[c(n,{label:"Sí, eliminar",icon:"pi pi-check",class:"p-button-danger",onClick:q}),c(n,{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:S})])]),_:1},8,["visible"])])])],64)}}},xe=J(me,[["__scopeId","data-v-e24c84a5"]]);export{xe as default};
