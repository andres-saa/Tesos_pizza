import{d as z,U as D,q as E,p as N,E as I,A as F,j as M,G as A,o as c,c as u,i as _,I as S,O as B,x as k,P as U,J as G,a as o,t as h,_ as H,g as q,u as W,m as J,k as Y,r as K,F as j,h as O,f as i,y as b,M as L,n as Q,w as v,b as R,s as $}from"./index-Bttz-1xV.js";const X=z("reportes",{persist:{key:"reportes",storage:localStorage,paths:["dateRange","salesReport","selectedSites","order_status","visibleNotifications"]},state:()=>({dateRange:{startDate:new Date(new Date().setDate(new Date().getDate()-7)),endDate:new Date},loading:{visible:!1,tittle:"Cargando"},visible:{show_validate:!1,show_new_product:!0}}),getters:{lastWeek:e=>{const a=new Date,t=new Date;return t.setDate(a.getDate()-7),{startDate:t,endDate:a}},lastMidMonth:e=>{const a=new Date,t=new Date;return t.setDate(a.getDate()-14),{startDate:t,endDate:a}},lastMonth:e=>{const a=new Date,t=new Date;return t.setDate(a.getDate()-28),{startDate:t,endDate:a}},dateRangeDifference(e){const a=new Date(e.dateRange.endDate),t=new Date(e.dateRange.startDate),n=Math.abs(a-t),s=Math.ceil(n/(1e3*60*60*24));console.log(s,"dif");let r="";switch(s){case 8:r="Últimos 7 días";break;case 15:r="Últimos 14 días";break;case 29:r="Últimos 28 días";break;default:r=null}return{diffDays:s,rangeName:r}}},actions:{async fetchSalesReport(){if(this.selectedSites.length<1){alert("Selecciones las sedes pare el reporte, gracias.");return}const e=this.formatDate(this.dateRange.startDate),a=this.formatDate(this.dateRange.endDate),t=this.selectedSites.map(r=>r.site_id).join(","),n=new URLSearchParams({site_ids:t,status:this.order_status,start_date:e,end_date:a}),s=`${D}/sales_report?${n.toString()}`;try{this.setLoading(!0,"cargando reporte");const r=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw this.setLoading(!1,"cargando reporte"),new Error(`HTTP error! status: ${r.status}`);const l=await r.json();this.salesReport=l,this.fetchDilyReport(),this.fetchDilyOrdersReport(),this.fetchTicketsReport(),console.log(l),this.setLoading(!1,"cargando reporte")}catch(r){console.error("Fetch error:",r),this.setLoading(!1,"cargando reporte")}},formatDate(e){const a=new Date(e),t=a.getFullYear(),n=(a.getMonth()+1).toString().padStart(2,"0"),s=a.getDate().toString().padStart(2,"0");return`${t}-${n}-${s}`},setDateRange(e,a){this.dateRange.startDate=new Date(e),this.dateRange.endDate=new Date(a)},async fetchDilyReport(){const e=this.formatDate(this.dateRange.startDate),a=this.formatDate(this.dateRange.endDate),t=this.selectedSites.map(r=>r.site_id).join(","),n=new URLSearchParams({site_ids:t,status:this.order_status,start_date:e,end_date:a}),s=`${D}/daily_sales?${n.toString()}`;try{const r=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const l=await r.json();return this.setChartData(l),l}catch(r){console.error("Fetch error:",r)}},async fetchDilyOrdersReport(){const e=this.formatDate(this.dateRange.startDate),a=this.formatDate(this.dateRange.endDate),t=this.selectedSites.map(r=>r.site_id).join(","),n=new URLSearchParams({site_ids:t,status:this.order_status,start_date:e,end_date:a}),s=`${D}/daily_orders?${n.toString()}`;try{const r=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const l=await r.json();return this.setCharOrdersData(l),l}catch(r){console.error("Fetch error:",r)}},async fetchTicketsReport(){const e=this.formatDate(this.dateRange.startDate),a=this.formatDate(this.dateRange.endDate),t=this.selectedSites.map(r=>r.site_id).join(","),n=new URLSearchParams({site_ids:t,status:this.order_status,start_date:e,end_date:a}),s=`${D}/daily_average_ticket?${n.toString()}`;try{const r=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const l=await r.json();return this.setCharTicketsData(l),l}catch(r){console.error("Fetch error:",r)}},setChartData(e){const a=[],t=[];e.forEach(n=>{Object.keys(n).forEach(s=>{a.includes(s)||a.push(s)}),Object.values(n).forEach(s=>{t.push(s)})}),this.ventasCharData={labels:a,datasets:[{label:"Venta",data:t,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharOrdersData(e){const a=[],t=[];e.forEach(n=>{Object.keys(n).forEach(s=>{a.includes(s)||a.push(s)}),Object.values(n).forEach(s=>{t.push(s)})}),this.ordersCharData={labels:a,datasets:[{label:"Venta",data:t,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharTicketsData(e){const a=[],t=[];e.forEach(n=>{Object.keys(n).forEach(s=>{a.includes(s)||a.push(s)}),Object.values(n).forEach(s=>{t.push(s)})}),this.ticketsCharData={labels:a,datasets:[{label:"Venta",data:t,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setSelectedSites(e){this.selectedSites=e,localStorage.setItem("selectedSites",JSON.stringify(e))},setOrderStatus(e){this.order_status=e,localStorage.setItem("orderStatus",e)},toogleVisibleNotifications(e){this.visibleNotifications=!this.visibleNotifications},setLoading(e,a="cargando"){this.loading={visible:e,tittle:a}},setVisibleOrder(e,a={}){e||(this.visibleOrder.order={}),this.visibleOrder={visible:e,order:a}}}}),C=X(),T=E(),x=N(),w=I(),Z=()=>{var p,d,g,f;T.sending_order=!0;const e=T.cart.products.map(m=>({product_instance_id:m.product.id,quantity:m.quantity})),a=T.cart.additions.map(m=>({aditional_item_instance_id:m.id,quantity:m.quantity})),t=x.location.site.site_id,n=(p=w.user.payment_method_option)==null?void 0:p.id,s=n===7?0:x.location.neigborhood.delivery_price,r=T.cart.order_notes,l={user_name:w.user.name,user_phone:(d=w.user.phone_number)==null?void 0:d.split(" ").join(""),user_address:` ${w.user.address} ${(f=(g=x.location)==null?void 0:g.neigborhood)==null?void 0:f.name}`||""};return{order_products:e,site_id:t,delivery_person_id:4,payment_method_id:n,delivery_price:s,order_notes:r||"SIN NOTAS",user_data:l,order_aditionals:a}},tt={async sendOrder(){const e=Z(),a=E();if(!et(e))return a.sending_order=!1,null;try{C.setLoading(!0,`enviando tu pedido ${w.user.name}`);const t=await F.post(`${D}/order`,e);if(t.status===200)a.sending_order=!1,a.last_order=t.data,C.setLoading(!1,"enviando tu pedido"),pixel.sendTrackingEvent("Purchase",{total:a.cart.total_cost,currency:"COP",items:a.cart.products.map(n=>({id:n.product.id,name:n.product.product_name,quantity:n.quantity,price:n.product.price})),value:a.cart.total_cost}),M.push("/gracias");else return console.error("An error occurred while sending the order:",t.status),alert("An error occurred while sending the order. Please try again."),C.setLoading(!1,"enviando tu pedido"),a.sending_order=!1,null}catch(t){return console.error("An error occurred while sending the order:",t),C.setLoading(!1,"enviando tu pedido"),a.sending_order=!1,alert("An error occurred while sending the order. Please check your internet connection and try again."),a.sending_order=!1,null}}};function et(e){const a=E();return e.order_products.every(t=>t.product_instance_id&&t.quantity)?!e.user_data.user_name||e.user_data.user_name.trim()==""||!e.user_data.user_phone||e.user_data.user_phone.trim()==""||!e.user_data.user_address||e.user_data.user_address.trim()==""?(alert("Sus datos estan incompletos por favor reviselos"),a.sending_order=!1,!1):!e.site_id||e.delivery_price==null?(alert("Site information is missing. Please select a valid site."),a.sending_order=!1,!1):!0:(alert("Some products in your cart are missing details."),a.sending_order=!1,!1)}var at=function(a){var t=a.dt;return`
.p-tag {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: `.concat(t("tag.primary.background"),`;
    color: `).concat(t("tag.primary.color"),`;
    font-size: `).concat(t("tag.font.size"),`;
    font-weight: `).concat(t("tag.font.weight"),`;
    padding: `).concat(t("tag.padding"),`;
    border-radius: `).concat(t("tag.border.radius"),`;
    gap: `).concat(t("tag.gap"),`;
}

.p-tag-icon {
    font-size: `).concat(t("tag.icon.size"),`;
    width: `).concat(t("tag.icon.size"),`;
    height:`).concat(t("tag.icon.size"),`;
}

.p-tag-rounded {
    border-radius: `).concat(t("tag.rounded.border.radius"),`;
}

.p-tag-success {
    background: `).concat(t("tag.success.background"),`;
    color: `).concat(t("tag.success.color"),`;
}

.p-tag-info {
    background: `).concat(t("tag.info.background"),`;
    color: `).concat(t("tag.info.color"),`;
}

.p-tag-warn {
    background: `).concat(t("tag.warn.background"),`;
    color: `).concat(t("tag.warn.color"),`;
}

.p-tag-danger {
    background: `).concat(t("tag.danger.background"),`;
    color: `).concat(t("tag.danger.color"),`;
}

.p-tag-secondary {
    background: `).concat(t("tag.secondary.background"),`;
    color: `).concat(t("tag.secondary.color"),`;
}

.p-tag-contrast {
    background: `).concat(t("tag.contrast.background"),`;
    color: `).concat(t("tag.contrast.color"),`;
}
`)},st={root:function(a){var t=a.props;return["p-tag p-component",{"p-tag-info":t.severity==="info","p-tag-success":t.severity==="success","p-tag-warn":t.severity==="warn","p-tag-danger":t.severity==="danger","p-tag-secondary":t.severity==="secondary","p-tag-contrast":t.severity==="contrast","p-tag-rounded":t.rounded}]},icon:"p-tag-icon",label:"p-tag-label"},rt=A.extend({name:"tag",theme:at,classes:st}),nt={name:"BaseTag",extends:G,props:{value:null,severity:null,rounded:Boolean,icon:String},style:rt,provide:function(){return{$pcTag:this,$parentInstance:this}}},V={name:"Tag",extends:nt,inheritAttrs:!1};function ot(e,a,t,n,s,r){return c(),u("span",S({class:e.cx("root")},e.ptmi("root")),[e.$slots.icon?(c(),_(B(e.$slots.icon),S({key:0,class:e.cx("icon")},e.ptm("icon")),null,16,["class"])):e.icon?(c(),u("span",S({key:1,class:[e.cx("icon"),e.icon]},e.ptm("icon")),null,16)):k("",!0),e.value!=null||e.$slots.default?U(e.$slots,"default",{key:2},function(){return[o("span",S({class:e.cx("label")},e.ptm("label")),h(e.value),17)]}):k("",!0)],16)}V.render=ot;const it={class:"p-1 my-0 md:my-0 col-12"},dt={style:{position:"sticky",top:"5rem","border-radius":"0.5rem","z-index":"10= 0"},class:"col-12 p-3 p-shadow m-0"},ct={style:{display:"flex","justify-content":"space-between",padding:"0",margin:"0","margin-bottom":"0"}},lt={style:{display:"flex","align-items":"center",padding:"0",margin:"0"}},ut={style:{"min-width":"2rem","font-weight":"bold"}},pt={style:{"text-align":"right",padding:"0",margin:"0"}},gt={class:"col-12 p-0 mt-1"},ht={class:"mb-0"},ft={class:"mb-1 text-center"},mt={style:{display:"flex",width:"100%",gap:"1rem","justify-content":"space-between"}},yt={class:"text adicion",style:{"text-transform":""}},_t={key:0,class:"pl-2 text-sm"},bt={style:{display:"flex","flex-direction":"column"}},vt={style:{display:"flex","justify-content":"space-between",padding:"0",margin:"0"}},Dt={style:{display:"flex","justify-content":"space-between",padding:"0",margin:"0"}},wt={key:0,style:{color:"var(--primary-color)"}},kt={key:1},St={style:{display:"flex","justify-content":"space-between",padding:"0",margin:"0"}},Rt={__name:"resumen",setup(e){const a=q(!1),t=W(),n=E(),s=N(),r=I(),l=q({}),P=()=>{l.value=n.cart.additions.reduce((p,d)=>{let g=d.group;return p[g]||(p[g]=[]),p[g].push(d),p},{})};return J(()=>{var p;P(),((p=r.user.payment_method_option)==null?void 0:p.id)!=7?s.setNeighborhoodPrice():s.setNeighborhoodPriceCero()}),Y(()=>n.cart.additions,()=>{P()},{deep:!0}),(p,d)=>{const g=K("router-link");return c(),u("div",it,[o("div",dt,[d[6]||(d[6]=o("h5",null,[o("b",null,"Resumen")],-1)),d[7]||(d[7]=o("h5",null,[o("b",null,"productos")],-1)),(c(!0),u(j,null,O(i(n).cart.products,f=>(c(),u("div",ct,[o("div",lt,[o("span",ut,h(f.quantity),1),o("span",null,h(f.product.product_name),1)]),o("div",pt,[o("span",null,h(i(b)(f.total_cost)),1)])]))),256)),o("div",gt,[(c(!0),u(j,null,O(l.value,(f,m)=>(c(),u("div",{class:"p-0 mb-2",key:m,style:{position:"relative","border-radius":"0.3rem"}},[o("div",ht,[o("span",ft,[o("b",null,h(m),1)]),(c(!0),u(j,null,O(f,y=>(c(),u("div",{key:y.aditional_item_instance_id,style:{display:"flex",gap:"1rem","align-items":"center"}},[o("div",mt,[o("span",yt,[o("span",null,[o("b",null,h(y.quantity),1)]),L(" "+h(y.name),1)]),y.price>0?(c(),u("span",_t,[o("b",null,h(i(b)(y.price*y.quantity)),1)])):k("",!0)])]))),128))])]))),128))]),o("div",bt,[o("div",vt,[d[1]||(d[1]=o("span",null,[o("b",null,"Subtotal")],-1)),o("span",null,[o("b",null,h(i(b)(i(n).cart.total_cost)),1)])]),o("div",Dt,[o("span",{style:Q(i(s).location.neigborhood.delivery_price==0?"text-decoration: line-through;":"")},d[2]||(d[2]=[o("b",null,"Domicilio",-1)]),4),i(s).location.neigborhood.delivery_price==0?(c(),u("span",wt,d[3]||(d[3]=[o("b",null,"Recoger en local",-1)]))):(c(),u("span",kt,[o("b",null,h(i(b)(i(s).location.neigborhood.delivery_price)),1)]))]),o("div",St,[d[4]||(d[4]=o("span",null,[o("b",null,"Total")],-1)),o("span",null,[o("b",null,h(i(b)(i(n).cart.total_cost+i(s).location.neigborhood.delivery_price)),1)])])]),i(t).path.includes("cart")?(c(),_(g,{key:0,to:"/"},{default:v(()=>[R(i($),{outlined:"",icon:"pi pi-shopping-cart",label:"Seguir comprando",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})):(c(),_(g,{key:1,to:"/"},{default:v(()=>[R(i($),{outlined:"",icon:"pi pi-arrow-left",label:"Volver al carrito",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})),i(s).status=="cerrado"?(c(),_(i(V),{key:2,style:{width:"100%",height:"2.5rem"},class:"mt-2",severity:"danger"},{default:v(()=>d[5]||(d[5]=[L(" Este Restaurante esta cerrado")])),_:1})):k("",!0),i(t).path.includes("cart")&&i(s).status!="cerrado"?(c(),_(g,{key:3,to:"/pay"},{default:v(()=>[R(i($),{iconPos:"right",icon:"pi pi-arrow-right",label:"Pedir",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}})]),_:1})):i(s).status!="cerrado"?(c(),_(g,{key:4,to:"/pay"},{default:v(()=>[R(i($),{disabled:i(n).sending_order||i(s).status=="cerrado",onClick:d[0]||(d[0]=()=>{i(tt).sendOrder(),a.value=!0}),iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}},null,8,["disabled"])]),_:1})):k("",!0)])])}}},Ct=H(Rt,[["__scopeId","data-v-e870841d"]]);export{Ct as r,V as s};
