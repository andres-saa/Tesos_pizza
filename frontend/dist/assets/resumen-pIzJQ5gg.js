import{d as M,U as k,u as O,b as V,J as F,L as U,x as A,_ as B,k as N,a as G,l as H,y as W,r as z,g as i,o as l,c as _,e as o,F as R,q as x,t as h,j as D,D as v,w,i as q,K as I,v as C,n as J,f as E,s as j}from"./index-3TSIe7Kj.js";const K=M("reportes",{persist:{key:"reportes",storage:localStorage,paths:["dateRange","salesReport","selectedSites","order_status","visibleNotifications"]},state:()=>({dateRange:{startDate:new Date(new Date().setDate(new Date().getDate()-7)),endDate:new Date},loading:{visible:!1,tittle:"Cargando"},visible:{show_validate:!1,show_new_product:!0}}),getters:{lastWeek:t=>{const e=new Date,s=new Date;return s.setDate(e.getDate()-7),{startDate:s,endDate:e}},lastMidMonth:t=>{const e=new Date,s=new Date;return s.setDate(e.getDate()-14),{startDate:s,endDate:e}},lastMonth:t=>{const e=new Date,s=new Date;return s.setDate(e.getDate()-28),{startDate:s,endDate:e}},dateRangeDifference(t){const e=new Date(t.dateRange.endDate),s=new Date(t.dateRange.startDate),n=Math.abs(e-s),a=Math.ceil(n/(1e3*60*60*24));console.log(a,"dif");let r="";switch(a){case 8:r="Últimos 7 días";break;case 15:r="Últimos 14 días";break;case 29:r="Últimos 28 días";break;default:r=null}return{diffDays:a,rangeName:r}}},actions:{async fetchSalesReport(){if(this.selectedSites.length<1){alert("Selecciones las sedes pare el reporte, gracias.");return}const t=this.formatDate(this.dateRange.startDate),e=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(r=>r.site_id).join(","),n=new URLSearchParams({site_ids:s,status:this.order_status,start_date:t,end_date:e}),a=`${k}/sales_report?${n.toString()}`;try{this.setLoading(!0,"cargando reporte");const r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw this.setLoading(!1,"cargando reporte"),new Error(`HTTP error! status: ${r.status}`);const c=await r.json();this.salesReport=c,this.fetchDilyReport(),this.fetchDilyOrdersReport(),this.fetchTicketsReport(),console.log(c),this.setLoading(!1,"cargando reporte")}catch(r){console.error("Fetch error:",r),this.setLoading(!1,"cargando reporte")}},formatDate(t){const e=new Date(t),s=e.getFullYear(),n=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${s}-${n}-${a}`},setDateRange(t,e){this.dateRange.startDate=new Date(t),this.dateRange.endDate=new Date(e)},async fetchDilyReport(){const t=this.formatDate(this.dateRange.startDate),e=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(r=>r.site_id).join(","),n=new URLSearchParams({site_ids:s,status:this.order_status,start_date:t,end_date:e}),a=`${k}/daily_sales?${n.toString()}`;try{const r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const c=await r.json();return this.setChartData(c),c}catch(r){console.error("Fetch error:",r)}},async fetchDilyOrdersReport(){const t=this.formatDate(this.dateRange.startDate),e=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(r=>r.site_id).join(","),n=new URLSearchParams({site_ids:s,status:this.order_status,start_date:t,end_date:e}),a=`${k}/daily_orders?${n.toString()}`;try{const r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const c=await r.json();return this.setCharOrdersData(c),c}catch(r){console.error("Fetch error:",r)}},async fetchTicketsReport(){const t=this.formatDate(this.dateRange.startDate),e=this.formatDate(this.dateRange.endDate),s=this.selectedSites.map(r=>r.site_id).join(","),n=new URLSearchParams({site_ids:s,status:this.order_status,start_date:t,end_date:e}),a=`${k}/daily_average_ticket?${n.toString()}`;try{const r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const c=await r.json();return this.setCharTicketsData(c),c}catch(r){console.error("Fetch error:",r)}},setChartData(t){const e=[],s=[];t.forEach(n=>{Object.keys(n).forEach(a=>{e.includes(a)||e.push(a)}),Object.values(n).forEach(a=>{s.push(a)})}),this.ventasCharData={labels:e,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharOrdersData(t){const e=[],s=[];t.forEach(n=>{Object.keys(n).forEach(a=>{e.includes(a)||e.push(a)}),Object.values(n).forEach(a=>{s.push(a)})}),this.ordersCharData={labels:e,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setCharTicketsData(t){const e=[],s=[];t.forEach(n=>{Object.keys(n).forEach(a=>{e.includes(a)||e.push(a)}),Object.values(n).forEach(a=>{s.push(a)})}),this.ticketsCharData={labels:e,datasets:[{label:"Venta",data:s,fill:!0,tension:.4,backgroundColor:this.order_status=="enviada"?"#d0e1fd":"rgba(255, 99, 132, 0.2)",borderColor:this.order_status=="enviada"?"#3b82f6":"rgba(255, 99, 132, 1)",borderWidth:1.8}]},getComputedStyle(document.documentElement)},setSelectedSites(t){this.selectedSites=t,localStorage.setItem("selectedSites",JSON.stringify(t))},setOrderStatus(t){this.order_status=t,localStorage.setItem("orderStatus",t)},toogleVisibleNotifications(t){this.visibleNotifications=!this.visibleNotifications},setLoading(t,e="cargando"){this.loading={visible:t,tittle:e}},setVisibleOrder(t,e={}){t||(this.visibleOrder.order={}),this.visibleOrder={visible:t,order:e}}}}),T=K(),P=O(),L=V(),b=F(),Y=()=>{var p,d,g,S;P.sending_order=!0;const t=P.cart.products.map(f=>({product_instance_id:f.product.id,quantity:f.quantity,sabors:f.flavors?f.flavors.map(u=>u.id):[]})),e=P.cart.additions.map(f=>({aditional_item_instance_id:f.id,quantity:f.quantity})),s=L.location.site.site_id,n=(p=b.user.payment_method_option)==null?void 0:p.id,a=n===7?0:L.location.neigborhood.delivery_price,r=P.cart.order_notes||"SIN NOTAS",c={user_name:b.user.name,user_phone:(d=b.user.phone_number)==null?void 0:d.split(" ").join(""),user_address:` ${b.user.address} ${(S=(g=L.location)==null?void 0:g.neigborhood)==null?void 0:S.name}`||"",site_id:s};return{order_products:t,order_aditionals:e,site_id:s,delivery_person_id:4,payment_method_id:n,delivery_price:a,order_notes:r,user_data:c,user_id:b.user.id,inserted_by:b.user.id,order_status:{status:"Pendiente",timestamp:new Date().toISOString().slice(0,10)},status_history:[{status:"Pendiente",timestamp:new Date().toISOString().slice(0,10)}]}},Q={async sendOrder(){const t=Y(),e=O();if(!X(t))return e.sending_order=!1,null;try{T.setLoading(!0,`enviando tu pedido ${b.user.name}`);const s=await U.post(`${k}/order`,t);if(s.status===200)e.sending_order=!1,e.last_order=s.data,T.setLoading(!1,"enviando tu pedido"),A.push("/gracias");else return console.error("An error occurred while sending the order:",s.status),alert("An error occurred while sending the order. Please try again."),T.setLoading(!1,"enviando tu pedido"),e.sending_order=!1,null}catch(s){return console.error("An error occurred while sending the order:",s),T.setLoading(!1,"enviando tu pedido"),e.sending_order=!1,alert("An error occurred while sending the order. Please check your internet connection and try again."),e.sending_order=!1,null}}};function X(t){const e=O();return t.order_products.every(s=>s.product_instance_id&&s.quantity)?!t.user_data.user_name||t.user_data.user_name.trim()==""||!t.user_data.user_phone||t.user_data.user_phone.trim()==""||!t.user_data.user_address||t.user_data.user_address.trim()==""?(alert("Sus datos estan incompletos por favor reviselos"),e.sending_order=!1,!1):!t.site_id||t.delivery_price==null?(alert("Site information is missing. Please select a valid site."),e.sending_order=!1,!1):!0:(alert("Some products in your cart are missing details."),e.sending_order=!1,!1)}const Z={key:0,class:"p-0 my-1 md:my col-12"},ee={style:{position:"sticky",top:"5rem","border-radius":"0.5rem","z-index":"100","box-shadow":"0 .5rem 1rem #00000020",border:"1px solid #00000040"},class:"col-12 p-3 p-shadow m-0"},te={style:{display:"flex","justify-content":"space-between","flex-direction":"column",padding:"0",margin:"0","margin-bottom":"0"}},se={style:{display:"flex","justify-content":"space-between",padding:"0",margin:"0","margin-bottom":"0"}},ae={style:{display:"flex","align-items":"center",padding:"0",margin:"0"}},re={style:{"min-width":"2rem","font-weight":"bold"}},oe={style:{"text-align":"right",padding:"0",margin:"0"}},ne={style:{display:"flex",gap:"1rem","align-items":"center","justify-content":"end",padding:"0",width:"100%","flex-wrap":"wrap"}},ie={style:{display:"flex",gap:"0.2rem","align-items":"end","flex-direction":"column"}},de={style:{color:"black"}},le={class:"col-12 p-0 mt-1"},ce={class:"mb-0"},ue={class:"mb-1 text-center"},he={style:{display:"flex",width:"100%",gap:"1rem","justify-content":"space-between"}},pe={class:"text adicion",style:{"text-transform":""}},ge={key:0,class:"pl-2 text-sm"},_e={style:{display:"flex","flex-direction":"column"}},fe={style:{display:"flex","justify-content":"space-between",padding:"0",margin:"0"}},me={style:{display:"flex","justify-content":"space-between",padding:"0",margin:"0"}},ye={key:0,style:{color:"var(--primary-color)"}},be={key:1},De={style:{display:"flex","justify-content":"space-between",padding:"0",margin:"0"}},ve={__name:"resumen",setup(t){const e=N(!1),s=G(),n=O(),a=V(),r=F(),c=N({}),$=()=>{c.value=n.cart.additions.reduce((p,d)=>{let g=d.group;return p[g]||(p[g]=[]),p[g].push(d),p},{})};return H(()=>{var p,d;$(),((p=r.user.payment_method_option)==null?void 0:p.id)!=7?a.setNeighborhoodPrice():a.setNeighborhoodPriceCero(),((d=a.location)==null?void 0:d.neigborhood.delivery_price)===null&&(a.visibles.currentSite=!0)}),W(()=>n.cart.additions,()=>{$()},{deep:!0}),(p,d)=>{var S,f;const g=z("router-link");return((f=(S=i(n).cart)==null?void 0:S.products)==null?void 0:f.length)>0?(l(),_("div",Z,[o("div",ee,[d[6]||(d[6]=o("h5",null,[o("b",null,"Resumen")],-1)),d[7]||(d[7]=o("h5",null,[o("b",null,"productos")],-1)),(l(!0),_(R,null,x(i(n).cart.products,u=>(l(),_("div",te,[o("div",se,[o("div",ae,[o("span",re,h(u.quantity),1),o("span",null,h(u.product.product_name),1)]),o("div",oe,[o("span",null,h(i(D)(u.total_cost)),1)])]),o("div",ne,[o("div",ie,[(l(!0),_(R,null,x(u.flavors,(y,m)=>(l(),v(i(I),{key:m,style:{padding:"0"}},{default:w(()=>[o("span",de,h(u.flavors.length>1?"1/2":"sabor"),1),q(" "+h(y.name)+" "+h((u==null?void 0:u.quantity)>1&&y.price>0?`x ${u.quantity} =`:"")+" "+h(y.price*u.quantity>0?i(D)(y.price/2*u.quantity):""),1)]),_:2},1024))),128))])])]))),256)),o("div",le,[(l(!0),_(R,null,x(c.value,(u,y)=>(l(),_("div",{class:"p-0 mb-2",key:y,style:{position:"relative","border-radius":"0.3rem"}},[o("div",ce,[o("span",ue,[o("b",null,h(y),1)]),(l(!0),_(R,null,x(u,m=>(l(),_("div",{key:m.aditional_item_instance_id,style:{display:"flex",gap:"1rem","align-items":"center"}},[o("div",he,[o("span",pe,[o("span",null,[o("b",null,h(m.quantity),1)]),q(" "+h(m.name),1)]),m.price>0?(l(),_("span",ge,[o("b",null,h(i(D)(m.price*m.quantity)),1)])):C("",!0)])]))),128))])]))),128))]),o("div",_e,[o("div",fe,[d[1]||(d[1]=o("span",null,[o("b",null,"Subtotal")],-1)),o("span",null,[o("b",null,h(i(D)(i(n).cart.total_cost)),1)])]),o("div",me,[o("span",{style:J(i(a).location.neigborhood.delivery_price==0?"text-decoration: line-through;":"")},d[2]||(d[2]=[o("b",null,"Domicilio",-1)]),4),i(a).location.neigborhood.delivery_price==0?(l(),_("span",ye,d[3]||(d[3]=[o("b",null,"Recoger en local",-1)]))):(l(),_("span",be,[o("b",null,h(i(D)(i(a).location.neigborhood.delivery_price)),1)]))]),o("div",De,[d[4]||(d[4]=o("span",null,[o("b",null,"Total")],-1)),o("span",null,[o("b",null,h(i(D)(i(n).cart.total_cost+i(a).location.neigborhood.delivery_price)),1)])])]),i(s).path.includes("cart")?(l(),v(g,{key:0,to:"/"},{default:w(()=>[E(i(j),{outlined:"",icon:"pi pi-shopping-cart",label:"Seguir comprando",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})):(l(),v(g,{key:1,to:"/cart"},{default:w(()=>[E(i(j),{outlined:"",icon:"pi pi-arrow-left",label:"Volver al carrito",class:"mt-4",severity:"danger",style:{outline:"none",width:"100%","font-weight":"bold","background-color":"rgba(0, 0, 0, 0)"}})]),_:1})),i(a).status=="cerrado"?(l(),v(i(I),{key:2,style:{width:"100%",height:"2.5rem"},class:"mt-2",severity:"danger"},{default:w(()=>d[5]||(d[5]=[q(" Este Restaurante esta cerrado")])),_:1})):C("",!0),i(s).path.includes("cart")&&i(a).status!="cerrado"?(l(),v(g,{key:3,to:"/pay"},{default:w(()=>[E(i(j),{iconPos:"right",icon:"pi pi-arrow-right",label:"Pedir",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}})]),_:1})):i(a).status!="cerrado"?(l(),v(g,{key:4,to:"/pay"},{default:w(()=>[E(i(j),{disabled:i(n).sending_order||i(a).status=="cerrado",onClick:d[0]||(d[0]=()=>{i(Q).sendOrder(),e.value=!0}),iconPos:"right",icon:"pi pi-arrow-right",label:"Finalizar pedido",class:"mt-2",severity:"help",style:{outline:"none",width:"100%",border:"none","font-weight":"bold","background-color":"black"}},null,8,["disabled"])]),_:1})):C("",!0)])])):C("",!0)}}},Se=B(ve,[["__scopeId","data-v-345aeb88"]]);export{Se as r};
